!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("formula-values")):"function"==typeof define&&define.amd?define(["formula-values"],r):"object"==typeof exports?exports.Sushi=r(require("formula-values")):e.Sushi=r(e["formula-values"])}(this,function(e){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var u in e)t.d(n,u,function(r){return e[r]}.bind(null,u));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=1)}([function(r,t){r.exports=e},function(e,r,t){"use strict";t.r(r);var n=function(e){return Array.isArray(e)},u=function(e){return"[object Object]"===Object.prototype.toString.call(e)},o={isArray:n,isObject:u,isObjectish:function(e){return e===Object(e)},omit:function(e,r){if(!u(e))return e;r=n(r)?r:[r];var t={};for(var o in e)e.hasOwnProperty(o)&&-1===r.indexOf(o)&&(t[o]=e[o]);return t}},a=function(e,r){if(!r.pivot)return console.warn("Overturn operation needs a 'pivot' parameter."),e;var t=r.pivot,n=r.dest||"parent",u=r.child||null,a=!!r.includeEmpty;return e.reduce(function(e,r){return function(e,r,t,n,u){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=o.omit(r,t),c=r[t];return o.isArray(c)?(a&&0===c.length&&c.push({}),e.concat(c.map(function(e){if(o.isObject(e))e[n]=i;else if(u){var r={};r[n]=i,r[u]=e,e=r}return e}))):o.isObject(c)||a&&(c={})?(c[n]=i,e.push(c),e):e}(e,r,t,n,u,a)},[])},i=t(0),c=function(e){return o.isArray(e)?e:[e]},f=new RegExp("(.+)\\[([0-9]*)\\]"),l=function(e,r,t){if(""===r)return e;for(var n,u,o=r.split(".");o.length&&e;)if(n=o.shift(),null!==(u=f.exec(n))&&3===u.length){var a={arrName:u[1],arrIndex:u[2]};e=void 0!==e[a.arrName]?e[a.arrName][a.arrIndex]:void 0}else e=isNaN(n)?e[n]:e[void 0===e[n]?Number(n):n];return void 0===e||o.length>0?t:e},s=function(e,r){return!e||(e=o.isArray(e)?e:[e]).reduce(function(e,t){var n=!1,u=t.indexOf("*");if(-1!==u){var o=t.lastIndexOf("*");-1!==o&&u!==o?n=r.includes(t.substring(u+1,o)):0===u?n=r.endsWith(t.substr(1)):u===t.length-1&&(n=r.startsWith(t.slice(0,-1)))}else n=r===t;return e||n},!1)},p=function(e,r){return Object.keys(e).filter(function(e){return s(r,e)})},h=function(e,r){r=r||"addition";var t={addition:{method:function(e,r){return e+r},neutral:0},subtraction:{method:function(e,r){return e-r},neutral:0},division:{method:function(e,r){return e/r},neutral:1},multiplication:{method:function(e,r){return e*r},neutral:1}};return e.reduce(function(e,n){return n=null==n?0:n,t[r].method(parseFloat(n)||t[r].neutral,e)},t[r].neutral)},v=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t[e]||(t[e]=new i.FormulaValue(e));var n=t[e];return n.eval(r)},d={get:l,set:function(e,r,t){for(var n,u=e,o=-1,a=(r=r.split(".")).length,i=a-1;null!==u&&++o<a;)u[n=r[o]]=o===i?t:void 0!==u[n]?u[n]:{},u=u[n];return e},remove:function(e,r){for(var t,n=e,u=-1,o=(r=r.split(".")).length,a=o-1;null!==n&&++u<o;)if(t=r[u],u===a)Array.isArray(n)?n.splice(t,1):delete n[t];else{if(void 0===n[t])break;n=n[t]}return e},extractMap:function(e,r,t){return c(r).map(function(r){return l(e,r,t)})},iterateMap:function(e,r,t,n){c(r).forEach(function(r){n(r,l(e,r,t))})},extractKeys:p,extractKeyValues:function(e,r){return p(e,r).map(function(r){return e[r]})},getKeys:function(e,r){return Object.keys(e).filter(function(e){return s(r,e)})},iterateKeys:function(e,r,t){Object.keys(e).forEach(function(e){s(r,e)&&t(e)})},evalValues:function(e,r){return e.reduce(function(e,t){return e||function(e,r){return!o.isArray(r)&&!o.isObject(r)&&("!"===e.charAt(0)?!r.includes(e.substr(1)):r.includes(e))}(t,r)},!1)},compare:function(e,r,t){var n={eq:function(e,r){return e===r},ne:function(e,r){return e!==r},lt:function(e,r){return e<r},gt:function(e,r){return e>r},le:function(e,r){return e<=r},ge:function(e,r){return e>=r}};return n[t=t||"eq"]?n[t](e,r):null},calculate:h,average:function(e){return 0===(e=e.filter(function(e){return null!=e})).length?0:h(e,"addition")/e.length},compareString:function(e,r,t){return{eq:function(e,r){return e===r},ne:function(e,r){return e!==r},includes:function(e,r){return e.includes(r)},startsWith:function(e,r){return e.startsWith(r)},endsWith:function(e,r){return e.endsWith(r)}}[t=t||"eq"](e,r)},evalFV:v,evalTemplate:function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!r)return{};if(r!==Object(r))return v(r,t,n);var u,o,a=Array.isArray(r)?r.slice():Object.assign({},r);for(var i in a)o=v(i,t,n),(u=a[i])===Object(u)?a[o]=e(u,t):a[o]=v(u,t,n),o!==i&&delete a[i];return a},deepNavigate:function e(){var r,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Array.isArray(t))for(var a=0;a<t.length;a++){var i=u.slice();i.push(a),r=t[a],o.isObjectish(r)?e(r,n,i):n(t,r,i)}else for(var c in t){var f=u.slice();f.push(c),r=t[c],o.isObjectish(r)?e(r,n,f):n(t,r,f)}},deepDelete:function e(){var r,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Array.isArray(t)){for(var a=[],i=0;i<t.length;i++){var c=u.slice();c.push(i),r=t[i],o.isObjectish(r)?e(r,n,c):n(t,r,c)&&a.push(i)}if(a.length)for(var f=a.length-1;f>=0;f--)t.splice(a[f],1)}else for(var l in t){var s=u.slice();s.push(l),r=t[l],o.isObjectish(r)?e(r,n,s):n(t,r,s)&&delete t[l]}}};function y(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function g(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function m(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var b=function(e,r){for(var t,n,u,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.length,i=0;i<a;i++){for(u in t={},n=e[i])t[n[u]]=d.get(r,u);o.push(t)}return o},O=function(e){var r,t,n=function(){return!1},u=n,o=n;if(void 0!==e.keyMatch){var a=e.keyMatch;r=!0,u=function(e){return e.match?e.match(a):e===a}}if(void 0!==e.valueMatch){var i=e.valueMatch;t=!0,o=function(e){return e?e.match?e.match(i):e===i:Object.is(e,NaN)?null==i:e==i}}return{evalKeyMatch:u,evalValueMatch:o,keyMatchExists:r,valueMatchExists:t}};var j=function(e,r,t){return d.evalFV(e,r,t)},x=function(e,r,t){if(Array.isArray(e)){for(var n=(i={},(a=r)in(o={})?Object.defineProperty(o,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[a]=i,o),u=0;u<e.length;u++)n[r][u]=e[u];return Object.assign(n,t)}return t;var o,a,i},A=function(e,r,t){var n=O(t);if(n.keyMatchExists||n.valueMatchExists){var u,o,a,i,c=t.replacement,f={$index:r,item:e},l={};d.deepNavigate(e,function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];u=t.slice(-1)[0],o=n.evalKeyMatch(u),a=n.evalValueMatch(r),i=null,o&&(i=x(o,"keyMatch",f)),a&&(i=x(a,"valueMatch",f)),i&&(i.key=u,i.value=r,e[u]=j(c,i,l))})}return e};function k(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function w(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?k(t,!0).forEach(function(r){P(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function P(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var M=function(e){for(var r,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],u=E(e),o=S(e,t),a=0;a<o;a++)r=w({},N(e,u),{},V(e,u,a)),n.push(r);return n},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={array:[],regular:[]};for(var t in e)Array.isArray(e[t])?r.array.push(t):r.regular.push(t);return r},S=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=0;if(r.reference&&e[r.reference]&&Array.isArray(e[r.reference]))t=e[r.reference].length;else for(var n in e)Array.isArray(e[n])&&e[n].length&&(t=e[n].length);return t},N=function(e,r){return r.regular.reduce(function(r,t){return r[t]=e[t],r},{})},V=function(e,r,t){return r.array.reduce(function(r,n){return r[n]=e[n][t],r},{})},D={overturn:a,filter:function(e,r,t){return r?(Array.isArray(r)||(r=[r]),e.filter(function(e){return r.reduce(function(r,n){return r&&t("filter",n.name,e,n)},!0)})):e},pick:function(e,r){return e.map(function(e){var t={};return r.keys&&d.iterateKeys(e,r.keys,function(n){r.values&&d.evalValues(r.values,e[n])?t[n]=e[n]:r.values||(t[n]=e[n])}),r.paths&&d.iterateMap(e,r.paths,null,function(e,r){t=d.set(t,e,r)}),t})},sort:function(e,r){if(!r)return e;Array.isArray(r)||(r=[r]),r=r.map(function(e){return{path:e.path,order:"desc"===e.order?-1:1}});return e.sort(function(e,t){for(var n,u,o=r.length,a=0,i=0;i<o;i++)if(n=d.get(e,r[i].path,""),u=d.get(t,r[i].path,""),0!==(a="number"==typeof n&&"number"==typeof u?n-u:String(n).localeCompare(String(u))))return a*=r[i].order;return a})},map:function(e,r,t){return r?(Array.isArray(r)||(r=[r]),e.map(function(e){return r.forEach(function(r){d.iterateKeys(e,r.keys,function(n){e[n]=t("mapper",r.name,e[n],r)})},{}),e})):e},explode:function(e,r){return e.reduce(function(e,t){return e.concat(Object.keys(t).reduce(function(e,n){var u={};if(r.id){if(r.id.includes(n))return e;u.id=d.get(t,r.id)}return u[r.key?r.key:"key"]=n,u[r.value?r.value:"value"]=t[n],e.push(u),e},[]))},[])},select:function(e,r,t){return r?(Array.isArray(r)||(r=[r]),e.map(function(e){return r.reduce(function(r,n){return r[n.dest]=t("selector",n.name,e,n),r},{})})):e},uniq:function(e,r){var t=[],n={};if(!r||!r.path)return console.warn("A 'path' parameter must be provided for the uniq operation."),e;for(var u=e.length-1;u>=0;u--)1!==n[d.get(e[u],r.path)]&&(n[d.get(e[u],r.path)]=1,t.push(e[u]));return t},reduce:function(e,r,t){return r?(Array.isArray(r)||(r=[r]),r.reduce(function(r,n){var u=n.start||0;if(n.group&&n.path){var o,a=r,i=e.reduce(function(e,r){return e[o=d.get(r,n.group)]=e[o]||0,e[o]++,e},{});n.dest&&(r[n.dest]={},a=r[n.dest]);var c={};e.forEach(function(e){o=d.get(e,n.group),c[o]=c[o]||0,a[o]=t("reducer",n.name,n,a[o]||u,d.get(e,n.path),c[o],i[o]),c[o]++})}else n.path&&n.dest?r[n.dest]=e.reduce(function(r,u,o){return t("reducer",n.name,n,r,d.get(u,n.path),o,e.length)},u):n.keys&&e.forEach(function(o,a){d.iterateKeys(o,n.keys,function(i){r[i]=t("reducer",n.name,n,r[i]||u,o[i],a,e.length)})});return r},{})):e},pivot:function(e,r){for(var t,n,u,o,a,i,c={sum:function(e,t){return e+d.get(t,r.aggregationPath,0)},count:function(e,r){return e+1}},f=[],l={},s=[],p=r.rowSourcePath,h=r.rowTargetPath||p,v=r.columnPath,y=!!r.includeRowTotal,g=!!r.includeColumnTotal,m=r.totalRowName||"Total",b=r.totalColumnName||"Total",O=c[r.aggregationOp||"count"],j=0,x=e.length;j<x;j++)if(n=e[j],o=d.get(n,p,void 0)){if(l[o])u=l[o];else{u={};for(var A=s.length-1;A>=0;A--)u[s[A]]=0;l[o]=u,f.push(u),d.set(u,h,o)}if(t=d.get(n,v,void 0)){if(-1===s.indexOf(t)){s.push(t);for(var k=f.length-1;k>=0;k--)f[k][t]=0}a=u[t]||0,u[t]=O(a,n)}}(y||g)&&function(){var e,r={};if(g){for(j=s.length-1;j>=0;j--)r[s[j]]=0;d.set(r,h,b)}for(j=0,i=f.length;j<i;j++){if(e=f[j],g)for(A=s.length-1;A>=0;A--)t=s[A],r[t]+=e[t];y&&(e[m]=s.reduce(function(r,t){return r+e[t]},0))}g&&(y&&(r[m]=s.reduce(function(e,t){return e+r[t]},0)),f.push(r))}();return f},classify:function(e,r){if(!r||!r.path)return console.warn("A 'path' parameter must be provided for the classify operation."),e;for(var t,n,u=r.path,o=r.dest||"dest",a=r.id||u,i=r.default,c={},f=e.length,l=0;l<f;l++)n=e[l],t=d.get(n,u),c[t=void 0!==t?t:i]=c[t]||{},c[t][o]=c[t][o]||[],c[t][o].push(n);return Object.keys(c).map(function(e){return function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?g(t,!0).forEach(function(r){m(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}(m({},a,e),c[e])})},split:function(e,r){if(!r||!r.parts)return console.warn("A 'parts' parameter must be provided for the split operation."),e;for(var t=[],n=r.parts,u=e.length,o=0;o<u;o++)t=b(n,e[o],t);return t},attach:function(e,r,t){return r?(Array.isArray(r)||(r=[r]),e.map(function(e,n){return r.forEach(function(r){e[r.dest]=t("attacher",r.name,e,r,n)}),e})):e},remove:function(e,r){var t=O(r),n=t.evalKeyMatch,u=t.evalValueMatch,o=t.keyMatchExists,a=t.valueMatchExists,i=r.paths;return e.map(function(e){var r;(i&&i.forEach(function(r){d.remove(e,r)}),o||a)&&d.deepDelete(e,function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r=o.slice(-1)[0],n(r)||u(t)});return e})},replace:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.map(function(e,t){return r.forEach(function(r){e=A(e,t,r)}),e})},explodeArrayProps:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.length)return e;for(var t=[],n=0;n<e.length;n++)t=t.concat(M(e[n],r));return t},subreduce:function(e,r){Array.isArray(r)&&(r=r[0]);var t,n=r&&r.currentDest?r.currentDest:"current",u=r&&r.nextDest?r.nextDest:"next";return 0===e.length?[]:1===e.length?[(t={},y(t,n,e[0]),y(t,u,null),t)]:e.slice(0,-1).map(function(r,t){var o;return y(o={},n,r),y(o,u,e[t+1]),o})}};function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var T={},q=function(e,r,t){return o.isArray(r)?r.reduce(function(r,n){return r||t(e,n)},!1):t(e,r)},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t=t||r.default||null,r.path)return d.get(e,r.path,t);if(r.expr){var n=r.expr;T[n]||(T[n]=new i.FormulaValue(n));var u=T[n];return u.eval(e)}return t},R={match:function(e,r){return q(F(e,r),r.match,function(e,r){return e===r})},mismatch:function(e,r){return q(F(e,r),r.match,function(e,r){return e!==r})},matchType:function(e,r){return q(F(e,r),r.match,function(e,r){return K(e)===r})},mismatchType:function(e,r){return q(F(e,r),r.match,function(e,r){return K(e)!==r})},includes:function(e,r){return q(F(e,r),r.match,function(e,r){return e.includes(r)})},excludes:function(e,r){return q(F(e,r),r.match,function(e,r){return!e.includes(r)})},compare:function(e,r){return d.compare(F(e,r),r.match,r.operator)},start:function(e,r){return q(F(e,r,""),r.match,function(e,r){return 0===e.indexOf(r)})},end:function(e,r){return q(F(e,r,""),r.match,function(e,r){return-1!==e.indexOf(r,e.length-r.length)})}},W={string:String,number:Number,boolean:Boolean},_={pass:function(e,r){return e},replace:function(e,r){if("string"!=typeof e)return e;var t=r.match||"";return r.regex&&(t=new RegExp(r.regex,"i")),e.replace(t,r.replacement||"")},substring:function(e,r){return"string"!=typeof e?e:e.substring(r.start||0,r.end||void 0)},translate:function(e,r){var t=r.conversions||r.convertions||{};return void 0!==t[e]?t[e]:e},classify:function(e,r){var t=r.conversions||r.convertions||{},n=Math.round(e);return void 0!==t[n]?t[n]:e},stratify:function(e,r){var t=r.conversions||r.convertions||{},n=r.default||e;return Object.keys(t).forEach(function(r){var u=r.split("-");2===u.length&&e>=Number(u[0])&&e<=Number(u[1])&&(n=t[r])}),n},cast:function(e,r){var t=r.type||"number";return W[t](e)}},I={},B={extract:function(e,r){return d.get(e,r.path,r.default)},join:function(e,r){return r.paths.map(function(t){return d.get(e,t,r.default)}).join(r.separator||" ")},split:function(e,r){var t=d.get(e,r.path,"");return("string"==typeof t?t:"number"==typeof t?""+t:"").split(r.separator||" ")},format:function(e,r){return r.paths.reduce(function(t,n,u){return t.replace("{"+u+"}",d.get(e,n,r.default))},r.format||"")},compare:function(e,r){return d.compare(d.get(e,r.path),r.match,r.operator)?r.truth:r.false},operation:function(e,r){return r.path?d.calculate([d.get(e,r.path),r.operand],r.operator):r.paths?d.calculate(d.extractMap(e,r.paths),r.operator):r.keys?d.calculate(d.extractKeyValues(e,r.keys),r.operator):0},average:function(e,r){return r.paths?d.average(d.extractMap(e,r.paths)):r.keys?d.average(d.extractKeyValues(e,r.keys)):0},existsInArray:function(e,r){var t=d.get(e,r.path);if(!o.isArray(t))return t;var n=r.matchValue||1,u=r.mismatchValue||0;return-1!==t.indexOf(r.match)?n:u},pluck:function(e,r){var t=d.get(e,r.path);return o.isArray(t)&&r.property?t.map(function(e){return d.get(e,r.property,r.default||e)}):t},count:function(e,r){var t=d.get(e,r.path);return o.isArray(t)?r.match?t.filter(function(e){return d.compare(e,r.match,r.operator)}).length:t.length:t},merge:function(e,r){var t,n=[];return r.paths.forEach(function(r){t=d.get(e,r),o.isArray(t)&&(n=n.concat(t))}),n},zip:function(e,r){var t,n,u,a=[];return r.paths.forEach(function(r){if(t=d.get(e,r),o.isArray(t))for(u=t.length,n=0;n<u;n++)a[n]||(a[n]=[]),a[n].push(t[n])}),a},itemAt:function(e,r){var t=d.get(e,r.path);if(!o.isArray(t))return r.default;var n=void 0!==r.index?r.index:0,u=t.length;if(0===u)return r.default;for(;n<0;)n=u+n;return void 0!==t[n]?t[n]:r.default},groupBy:function(e,r){var t=d.get(e,r.path),n=r.default;if(!o.isArray(t))return n;if(!r.group)return console.warn("A 'group' parameter must be provided for the groupBy operation."),n;for(var u,a,i={},c=r.group,f=t.length-1;f>=0;f--)a=t[f],i[u=void 0!==(u=d.get(a,c))?u:n]=i[u]||[],i[u].push(a);return i},objKeys:function(e,r){var t=d.get(e,r.path);return o.isObject?Object.keys(t):t},objValues:function(e,r){var t=d.get(e,r.path);return o.isObject?Object.values(t):t},objEntries:function(e,r){var t=d.get(e,r.path);return o.isObject?Object.entries(t):t},formula:function(e,r){return r.expr?(I[r.expr]||(I[r.expr]=new i.FormulaValue(r.expr)),I[r.expr].eval(e)):(console.warn("Invalid FormulaValue expression ('expr')."),e)}},C=function(e,r,t,n){return e.match?e.match===t?n():r:n()},J={count:function(e,r,t){return C(e,r,t,function(){return t?r+1:r})},operation:function(e,r,t){return C(e,r,t,function(){return d.calculate([t,r],e.operator)})},average:function(e,r,t,n,u){return C(e,r,t,function(){var e=d.calculate([t,r],"addition");return n<u-1?e:e/u})},sum:function(e,r,t){return C(e,r,t,function(){return d.calculate([t,r],"addition")})},sumAndOperation:function(e,r,t){var n=d.calculate([t,r],"addition");return d.calculate([n,e.operand],e.operator)},array:function(e,r,t){return(r=o.isArray(r)?r:[]).push(t),r}},$={formulaTemplate:function(e,r,t){if(!r.template)return console.warn("Missing attacher parameter ('template')."),null;var n={$index:t,item:e};return r.context&&(n.context=r.context),d.evalTemplate(r.template,n)},template:function(e,r){return r.template?r.template:(console.warn("Missing attacher parameter ('template')."),null)}};function z(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t.d(r,"default",function(){return ee});var L={filters:R,mappers:_,selectors:B,reducers:J,attachers:$},G={overturn:function(e,r){return D.overturn(e,r.cont)},filters:function(e,r){return D.filter(e,r.cont,X)},pick:function(e,r){return D.pick(e,r.cont)},mappers:function(e,r){return D.map(e,r.cont,X)},explode:function(e,r){return D.explode(e,r.cont)},selectors:function(e,r){return D.select(e,r.cont,X)},subreducers:function(e,r){return D.subreduce(e,r.cont)},reducers:function(e,r){return[D.reduce(e,r.cont,X)]},attachers:function(e,r){return D.attach(e,r.cont,X)},uniq:function(e,r){return D.uniq(e,r.cont)},pivot:function(e,r){return D.pivot(e,r.cont,X)},nest:function(e,r){var t=this,n=r.path,u=r.dest||n;return e.map(function(e){return d.set(e,u,Z.call(t,d.get(e,n,[]),r.cont))})},classify:function(e,r){return D.classify(e,r.cont,X)},split:function(e,r){return D.split(e,r.cont,X)},remove:function(e,r){return D.remove(e,r.cont)},replace:function(e,r){return D.replace(e,r.cont)},explodeArrayProps:function(e,r){return D.explodeArrayProps(e,r.cont)},sorters:function(e,r){return D.sort(e,r.cont)}},H=["overturn","filters","pick","sorters","mappers","explode","selectors","uniq","reducers","pivot"],Q=function(e,r){var t=e[0];if(t&&H.reduce(function(e,r){return e||!!t[r]},!1)){var n=[];return e.forEach(function(e){Object.keys(e).forEach(function(r){n.push({op:r,cont:e[r]})})}),r&&(console.warn("Legacy recipe found."),console.log("New recipe :"),console.log(JSON.stringify(n,null,3))),n}return e},U=function(e,r,t){return G[(r=r||{}).op]?e=G[r.op].call(this,e,r,t):console.warn("Not found: "+r.op+"."),e},X=function(e,r){if(L[e+"s"][r]){for(var t=arguments.length,n=new Array(t>2?t-2:0),u=2;u<t;u++)n[u-2]=arguments[u];return L[e+"s"][r].apply(void 0,n)}return Y(e,r)},Y=function(e,r){return console.warn(e+" "+r+" was not found in the available processes."),!1};function Z(e,r,t){var n=this;return o.isObject(r)?r=[r]:o.isArray(r)||(r=[]),r=Q(r,this.options.verbose),t&&(r=this.applyParameters(r,t)),r.forEach(function(r){e=U.call(n,e,r)}),e}var ee=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=r}var r,t,n;return r=e,(t=[{key:"addOperationsBundle",value:function(e){this.addOperations("filter",e.filters),this.addOperations("picker",e.pickers),this.addOperations("mapper",e.mappers),this.addOperations("reducer",e.reducers),this.addOperations("attach",e.attachers)}},{key:"addOperations",value:function(e,r){for(var t in r)this.addOperation(e,t,r[t])}},{key:"addOperation",value:function(e,r,t){if(!e)return function(e,r){return console.warn(e+" is not a valid process type."),!1}();L[e+"s"][r]=t}},{key:"addFilter",value:function(e,r){this.addOperation("filter",e,r)}},{key:"addMapper",value:function(e,r){this.addOperation("mapper",e,r)}},{key:"addReducer",value:function(e,r){this.addOperation("reducer",e,r)}},{key:"applyParameters",value:function(e,r){var t=JSON.stringify(e);for(var n in r)t=t.replace(new RegExp("#"+n+"#","g"),r[n]);return JSON.parse(t)}},{key:"cook",value:function(e,r,t){return Z.call(this,e,r,t)}},{key:"helper",value:function(){return d}}])&&z(r.prototype,t),n&&z(r,n),e}()}]).default});